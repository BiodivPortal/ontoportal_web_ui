(function(window,undefined) {
  // Abort it not right page
  var path = currentPathArray();
  if (path[0] !== "ontologies" || (path[0] === "ontologies" && path.length !== 2)) {
    return;
  }

  jQuery(document).data().bp.classesTab = {};


  // The tab system
  jQuery(".tab").live("click", function(){
    var tabId = jQuery(this).children("a:first").attr("href").replace("#", "");
    showClassesTab(tabId);
  });

  function showClassesTab(tabId) {
    // Get the target content area
    var target = document.getElementById(tabId + "_content");

    if (target != null) {
      jQuery(".tab_container").addClass("not_visible");
      jQuery(target).removeClass("not_visible");
      jQuery(".tab").removeClass("selected");
      jQuery("#" + tabId + "_top").addClass("selected");
      jQuery(document).trigger("classes_tab_visible");
    }

    jQuery(document).trigger("visualize_tab_change", [{tabType: tabId}]);
  }

  // Only show BioMixer when tab is clicked
  jQuery(document).live("visualize_tab_change", function(event, data){
    if (data.tabType == "visualization") {
      jQuery("#biomixer_iframe").attr("src", jQuery("#biomixer_iframe").data("src"));
    }
  });


  jQuery(document).ready(function(){
    // Tab auto-select based on parameter "t"
    var urlFragment, paramsList, splitParam, content,
        url = document.URL,
        params = {};

    if (url.indexOf("?") > 0) {
      urlFragment = url.split("?");
      paramsList = urlFragment[1].split("&");

      for (param in paramsList) {
        splitParam = paramsList[param].split("=");

        if (splitParam.length > 1)
          params[splitParam[0]] = splitParam[1].split("#")[0];
      }

      if (params !== "undefined" && "t" in params) {
        showClassesTab(params["t"]);
      }
    }

    jQuery("#classPermalinkModal").on("shown.bs.modal", function (e) {
      var currentPurl = jQuery("a.class-permalink").data("current-purl");
      jQuery("#purl_input").val(currentPurl);
    })

    jQuery("#purl_input").on("click", function () {
      jQuery(this).select();
    });
  });
})(window);
